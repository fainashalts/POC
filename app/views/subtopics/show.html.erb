<h1><%= @subtopic.name %></h1>

<% @subtopic.links.order(:cached_votes_total => :desc).each do |link| %>
	
	<ul>
		<li><h4><%= fetch(link.url.to_s).title %></h4></li>
        <li><%= fetch(link.url.to_s).description %></li>
        <li><img class="link-img" src="<%= fetch(link.url.to_s).images.first.src %>"></li>
        <li><%= link.subtopic.name %></li>
        <li><% if current_user.try(:admin?)%><%= link_to 'Delete', link_path(link), method: :delete, data: { confirm: 'Are you sure?' } %><%end%></li>
        <li><%= link_to "Comments", link_path(link) %> || (<%= link.comments.count %>)</li>   
        <li>
            <%= link_to like_link_path(link), method: :put do %>
              
              Upvote
          
              <%= link.get_upvotes.size %>

            <% end %> 
        </li>
	</ul>

<% end %>

<% if current_user %>

  <div class="modal fade" id="add-link-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Add a New Link!</h4>
          </div>
          <div class="modal-body">
            <%= render 'links/form', object: @link %>
          </div>
        </div>
      </div>
    </div>

    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#add-link-modal">Add a Link</button>


<% end %>